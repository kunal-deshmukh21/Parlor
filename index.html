<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Test Series - BPSC Preparation</title>

  <!-- Font Awesome Icons -->
  <link rel="stylesheet" th:href="@{/css/fontawesome/css/all.min.css}">
 

  <!-- SweetAlert2 -->   
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


  <!-- <link th:href="@{/import/sweetalert/sweetalert2.min.css}" rel="stylesheet">
  <script th:src="@{/import/sweetalert/sweetalert2.min.js}"></script> -->

  <!-- amCharts -->
  <script src="https://cdn.amcharts.com/lib/5/index.js"></script>
  <script src="https://cdn.amcharts.com/lib/5/xy.js"></script>
  <script src="https://cdn.amcharts.com/lib/5/themes/Animated.js"></script>

  <!-- Custom CSS & JS -->
  <link rel="stylesheet" th:href="@{/css/index.css}" />
  <link rel="stylesheet" th:href="@{/css/master/testSeries.css}" />
  <script th:src="@{/js/master/testSeries.js}"></script>

  <style>
    /* Loading Spinner */
    .loading-spinner {
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top: 4px solid #3b82f6;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin: 0 auto;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    /* Hide sections initially */
    .hidden {
      display: none !important;
    }
  </style>
</head>

<body>
  <!-- Header Navigation -->
  <div th:replace="fragments/header :: mainHeader"></div>

  <!-- Main Container -->
  <div class="main-container">

    <!-- ==================== SUBJECT SELECTION SECTION ==================== -->
    <section id="subjectSection">
      <div class="section-header">
        <h2><i class="fas fa-book"></i> Select Your Subject</h2>
        <p>Choose a subject to begin your test preparation journey</p>
      </div>

      <div class="subjects-container">
        <th:block th:each="subject : ${subjects}">
          <div class="subject-item" th:id="${subject.id}" onclick="openTree(this)">
            <i class="fas fa-graduation-cap"
              style="display: block; font-size: 48px; margin-bottom: 12px; opacity: 0.8;"></i>
            <span th:text="${subject.subjectName}">Subject Name</span>
          </div>
        </th:block>
      </div>
    </section>

    <!-- ==================== SUBJECT TYPE TREE SECTION ==================== -->
    <div class="tree-area" id="treeArea">
      <div class="subjectcat">
        <h2><i class="fas fa-sitemap"></i> Subject Categories</h2>
        <p>Select the type of preparation material</p>
      </div>

      <div class="tree-parent" id="treeParentName">
        <i class="fas fa-folder-open"></i> Subject
      </div>

      <div class="child-boxes" id="typeContainer">
        <!-- Types will be injected here -->
      </div>
    </div>

    <!-- ==================== CHAPTER SECTION ==================== -->
    <div class="chapter-question-container" id="chapterArea" style="display: none">

      <!-- Chapters -->
      <div class="chapter-left">
        <div class="chapter-title" id="selectedTypeName">
          <i class="fas fa-list-ul"></i> Chapters
        </div>

        <div class="chapter-list" id="chapterContainer">
          <!-- Chapters will be injected here -->
        </div>
      </div>

      <!-- Tests Dashboard -->
      <div class="question-area" style="display: none" id="questionArea">
        <div style="text-align: center; padding: 60px 20px; color: var(--gray-600);">
          <i class="fas fa-hand-pointer" style="font-size: 64px; margin-bottom: 20px; opacity: 0.3;"></i>
          <h3>कृपया अध्याय चुनें</h3>
          <p>Please select a chapter from above</p>
        </div>
      </div>

    </div>

    <!-- ==================== RESULT SECTION ==================== -->
    <section id="resultSection" style="display: none;">
      <div class="section-header">
        <h2><i class="fas fa-trophy"></i> Test Results</h2>
        <p>Here's how you performed</p>
      </div>

      <div
        style="background: white; border-radius: var(--radius-lg); padding: 48px 32px; box-shadow: var(--shadow-xl);">

        <!-- Chart Container -->
        <div id="chartdiv" style="width: 100%; max-width: 900px; height: 500px; margin: 0 auto 40px;"></div>

        <!-- Performance Summary -->
        <div
          style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 40px; max-width: 900px; margin-left: auto; margin-right: auto;">

          <div
            style="background: linear-gradient(135deg, #dcfce7, #bbf7d0); padding: 24px; border-radius: 12px; text-align: center;">
            <i class="fas fa-check-circle" style="font-size: 36px; color: var(--success); margin-bottom: 8px;"></i>
            <div style="font-size: 32px; font-weight: 800; color: var(--success);" id="correctCount">0</div>
            <div style="font-size: 14px; color: var(--gray-700); font-weight: 600;">Correct</div>
          </div>

          <div
            style="background: linear-gradient(135deg, #fee2e2, #fecaca); padding: 24px; border-radius: 12px; text-align: center;">
            <i class="fas fa-times-circle" style="font-size: 36px; color: var(--danger); margin-bottom: 8px;"></i>
            <div style="font-size: 32px; font-weight: 800; color: var(--danger);" id="wrongCount">0</div>
            <div style="font-size: 14px; color: var(--gray-700); font-weight: 600;">Wrong</div>
          </div>

          <div
            style="background: linear-gradient(135deg, #fef3c7, #fde68a); padding: 24px; border-radius: 12px; text-align: center;">
            <i class="fas fa-forward" style="font-size: 36px; color: var(--warning); margin-bottom: 8px;"></i>
            <div style="font-size: 32px; font-weight: 800; color: var(--warning);" id="skippedCount">0</div>
            <div style="font-size: 14px; color: var(--gray-700); font-weight: 600;">Skipped</div>
          </div>

        </div>

        <!-- Action Buttons -->
        <div class="question-actions"
          style="margin-top: 40px; display: flex; justify-content: center; gap: 16px; flex-wrap: wrap;">
          <button class="btn-prev" onclick="restartTest()"
            style="background: linear-gradient(135deg, var(--gray-600), var(--gray-800)); color: white; border: none; padding: 14px 32px; border-radius: 50px; font-weight: 700; cursor: pointer; transition: all 0.3s ease;">
            <i class="fas fa-redo"></i> Restart Test
          </button>

          <button class="btn-submit" onclick="viewSolution()"
            style="background: linear-gradient(135deg, var(--success), #16a34a); color: white; border: none; padding: 14px 32px; border-radius: 50px; font-weight: 700; cursor: pointer; transition: all 0.3s ease;">
            <i class="fas fa-book-open"></i> View Solutions
          </button>

          <button class="start-btn" onclick="goToNextChapter()"
            style="padding: 14px 32px; border-radius: 50px; font-weight: 700; cursor: pointer; transition: all 0.3s ease;">
            <i class="fas fa-arrow-left"></i> Back to Chapters
          </button>

          <button class="start-btn" onclick="startNextTest()"
            style="padding: 14px 32px; border-radius: 50px; font-weight: 700; cursor: pointer; transition: all 0.3s ease;">
            <i class="fas fa-arrow-right"></i> Next Test
          </button>
        </div>

      </div>
    </section>

  </div>

  <!-- ==================== TEST MODE CONTAINER (FULLSCREEN) ==================== -->
  <div class="test-mode-container" id="testModeContainer">

    <!-- Test Header with Timer -->
    <div class="test-header">
      <div class="test-header-left">
        <div class="test-title-small">
          <i class="fas fa-file-alt"></i> Test in Progress
        </div>
        <div class="question-counter" id="questionCounter">
          1 / 10
        </div>
      </div>

      <div style="display: flex; align-items: center; gap: 14px;">
        <!-- Pause Button -->
        <button class="pause-toggle-btn" onclick="togglePauseTest()" id="pauseBtn"
            title="Pause / Resume Test">
          <i class="fas fa-pause" id="pauseIcon"></i>
        </button>

        <!-- Timer -->
        <div class="timer-display" id="timerDisplay">
          <i class="fas fa-clock"></i>
          <span id="timerText">00:00</span>
        </div>
      </div>
    </div>

    <!-- Test Content -->
    <div class="test-content">
      <!-- Main Question Area -->
      <div class="test-main">
        <!-- Questions render here via JS -->
      </div>

      <!-- Question Palette Sidebar -->
      <div class="test-sidebar">
        <!-- Palette renders here via JS -->
      </div>
    </div>

  </div>

  <!-- Footer (Optional) -->
  <div th:replace="~{fragments/footer :: mainFooter}"></div>

</body>

</html>
